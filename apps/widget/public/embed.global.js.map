{"version":3,"sources":["../src/embed.ts"],"sourcesContent":["/**\n * Chatify Widget Embed Script (IIFE)\n *\n * Customers paste this into their website:\n *\n * <script\n *   src=\"https://widget.chatify.app/embed.js\"\n *   data-organization-id=\"org_abc123\"\n *   data-bot-id=\"bot_xyz789\"\n *   async\n * ></script>\n */\n\ninterface EmbedConfig {\n  organizationId: string;\n  botId: string;\n  position: \"bottom-right\" | \"bottom-left\" | \"top-right\" | \"top-left\";\n  theme: \"light\" | \"dark\";\n}\n\ninterface BotProfileResponse {\n  primaryColor?: string;\n  displayName?: string;\n}\n\n(function () {\n  const scriptTag = document.currentScript as HTMLScriptElement | null;\n\n  if (!scriptTag) {\n    console.error(\"Chatify: Unable to determine script element\");\n    return;\n  }\n\n  const organizationId = scriptTag.getAttribute(\"data-organization-id\");\n  const botId = scriptTag.getAttribute(\"data-bot-id\");\n  const position = (scriptTag.getAttribute(\"data-position\") ||\n    \"bottom-right\") as EmbedConfig[\"position\"];\n\n  if (!organizationId || !botId) {\n    console.error(\n      \"Chatify: Missing data-organization-id or data-bot-id attributes\",\n    );\n    return;\n  }\n\n  // embed.ts\n  const WIDGET_URL =\n    process.env.NEXT_PUBLIC_WIDGET_URL || \"http://localhost:3001\";\n  const VISITOR_STORAGE_KEY = \"chatify_visitor_id\";\n  const DEFAULT_PRIMARY_COLOR = \"#6366f1\";\n\n  function getVisitorId(): string {\n    let visitorId = localStorage.getItem(VISITOR_STORAGE_KEY);\n    if (!visitorId) {\n      visitorId = `visitor_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      localStorage.setItem(VISITOR_STORAGE_KEY, visitorId);\n    }\n    return visitorId;\n  }\n\n  function getPositionCSS(pos: string): string {\n    const positions: Record<string, string> = {\n      \"bottom-right\": \"right: 20px; bottom: 20px;\",\n      \"bottom-left\": \"left: 20px; bottom: 20px;\",\n      \"top-right\": \"right: 20px; top: 20px;\",\n      \"top-left\": \"left: 20px; top: 20px;\",\n    };\n    return positions[pos] || positions[\"bottom-right\"];\n  }\n\n  /**\n   * Lighten a hex color by a given percentage\n   */\n  function lightenColor(hex: string, percent: number): string {\n    const num = parseInt(hex.replace(\"#\", \"\"), 16);\n    const r = Math.min(\n      255,\n      (num >> 16) + Math.round(((255 - (num >> 16)) * percent) / 100),\n    );\n    const g = Math.min(\n      255,\n      ((num >> 8) & 0x00ff) +\n        Math.round(((255 - ((num >> 8) & 0x00ff)) * percent) / 100),\n    );\n    const b = Math.min(\n      255,\n      (num & 0x0000ff) + Math.round(((255 - (num & 0x0000ff)) * percent) / 100),\n    );\n    return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, \"0\")}`;\n  }\n\n  /**\n   * Generate gradient CSS from primary color\n   */\n  function getButtonGradient(primaryColor: string): string {\n    const lighterColor = lightenColor(primaryColor, 25);\n    return `linear-gradient(135deg, ${primaryColor} 0%, ${lighterColor} 100%)`;\n  }\n\n  function getChatBubbleSVG(): string {\n    return `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path>\n      </svg>\n    `;\n  }\n\n  function getCloseSVG(): string {\n    return `\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\n        <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n        <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n      </svg>\n    `;\n  }\n\n  function initWidget() {\n    const container = document.createElement(\"div\");\n    container.id = `chatify-widget-${organizationId}`;\n    container.setAttribute(\"data-chatify-widget\", \"true\");\n    document.body.appendChild(container);\n\n    const shadowRoot = container.attachShadow({ mode: \"open\" });\n\n    let isWidgetOpen = false;\n    let currentPrimaryColor = DEFAULT_PRIMARY_COLOR;\n\n    const styles = document.createElement(\"style\");\n    styles.textContent = `\n      * {\n        box-sizing: border-box;\n      }\n\n      #chatify-button {\n        position: fixed;\n        ${getPositionCSS(position)}\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background: ${getButtonGradient(DEFAULT_PRIMARY_COLOR)};\n        border: none;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        z-index: 999999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;\n        color: white;\n        outline: none;\n        -webkit-tap-highlight-color: transparent;\n      }\n\n      #chatify-button:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);\n      }\n\n      #chatify-button:active {\n        transform: scale(0.95);\n      }\n\n      #chatify-button.active {\n        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);\n      }\n\n      #chatify-button svg {\n        width: 28px;\n        height: 28px;\n        transition: transform 0.3s ease, opacity 0.2s ease;\n      }\n\n      #chatify-button.active svg {\n        transform: rotate(90deg);\n      }\n\n      #chatify-iframe {\n        position: fixed;\n        ${getPositionCSS(position)}\n        width: 400px;\n        height: 650px;\n        border: none !important;\n        border-radius: 16px;\n        box-shadow: 0 8px 48px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.06);\n        z-index: 999998;\n        background: transparent;\n        display: none;\n        overflow: hidden;\n        color-scheme: light dark;\n      }\n\n      #chatify-iframe.active {\n        display: block;\n        animation: chatifySlideIn 0.3s ease-out;\n      }\n\n      @keyframes chatifySlideIn {\n        from {\n          opacity: 0;\n          transform: translateY(12px) scale(0.97);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      @media (max-width: 480px) {\n        #chatify-iframe {\n          width: 100vw;\n          height: 100vh;\n          height: 100dvh;\n          border-radius: 0;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          box-shadow: none;\n        }\n\n        #chatify-button.active {\n          z-index: 9999999;\n        }\n      }\n    `;\n    shadowRoot.appendChild(styles);\n\n    const button = document.createElement(\"button\");\n    button.id = \"chatify-button\";\n    button.innerHTML = getChatBubbleSVG();\n    button.setAttribute(\"aria-label\", \"Open chat widget\");\n    button.setAttribute(\"aria-expanded\", \"false\");\n    shadowRoot.appendChild(button);\n\n    const iframe = document.createElement(\"iframe\");\n    iframe.id = \"chatify-iframe\";\n    iframe.src = `${WIDGET_URL}/widget?orgId=${organizationId}&botId=${botId}&visitorId=${getVisitorId()}`;\n    iframe.allow = \"camera; microphone\";\n    iframe.setAttribute(\"loading\", \"lazy\");\n    iframe.setAttribute(\"title\", \"Chatify Chat Widget\");\n    shadowRoot.appendChild(iframe);\n\n    /**\n     * Open the widget\n     */\n    function openWidget() {\n      isWidgetOpen = true;\n      iframe.classList.add(\"active\");\n      button.classList.add(\"active\");\n      button.innerHTML = getCloseSVG();\n      button.setAttribute(\"aria-expanded\", \"true\");\n      button.setAttribute(\"aria-label\", \"Close chat widget\");\n    }\n\n    /**\n     * Close the widget\n     */\n    function closeWidget() {\n      isWidgetOpen = false;\n      iframe.classList.remove(\"active\");\n      button.classList.remove(\"active\");\n      button.innerHTML = getChatBubbleSVG();\n      button.setAttribute(\"aria-expanded\", \"false\");\n      button.setAttribute(\"aria-label\", \"Open chat widget\");\n    }\n\n    /**\n     * Toggle widget open/close\n     */\n    function toggleWidget() {\n      if (isWidgetOpen) {\n        closeWidget();\n      } else {\n        openWidget();\n      }\n    }\n\n    // Button click toggles widget\n    button.addEventListener(\"click\", toggleWidget);\n\n    // Listen for postMessage from widget iframe\n    window.addEventListener(\"message\", (event) => {\n      const widgetOrigin = new URL(WIDGET_URL).origin;\n      if (event.origin !== widgetOrigin) {\n        return;\n      }\n\n      const data = event.data;\n\n      // Handle widget close request (from header X button)\n      if (data.type === \"widget:close\") {\n        closeWidget();\n      }\n\n      // Handle widget ready with bot config (apply dynamic color)\n      if (data.type === \"widget:ready\" && data.data?.primaryColor) {\n        currentPrimaryColor = data.data.primaryColor;\n        button.style.background = getButtonGradient(currentPrimaryColor);\n      }\n\n      // Handle widget config update (bot profile loaded, apply primary color)\n      if (data.type === \"widget:config\" && data.data?.primaryColor) {\n        currentPrimaryColor = data.data.primaryColor;\n        button.style.background = getButtonGradient(currentPrimaryColor);\n      }\n    });\n\n    console.log(\"Chatify widget loaded successfully\");\n  }\n\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", initWidget);\n  } else {\n    initWidget();\n  }\n})();\n"],"mappings":"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","names":["scriptTag","organizationId","botId","position","WIDGET_URL","VISITOR_STORAGE_KEY","DEFAULT_PRIMARY_COLOR","getVisitorId","visitorId","getPositionCSS","pos","positions","lightenColor","hex","percent","num","g","b","getButtonGradient","primaryColor","lighterColor","getChatBubbleSVG","getCloseSVG","initWidget","container","shadowRoot","isWidgetOpen","currentPrimaryColor","styles","button","iframe","openWidget","closeWidget","toggleWidget","event","_a","_b","widgetOrigin","data"]}